(()=>{var o={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},d:(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t),r:o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}},t={};(()=>{"use strict";o.r(t);const e=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/app"];var n=o.n(r);const s=flarum.core.compat["common/components/LinkButton"];var a=o.n(s);const i=flarum.core.compat["common/helpers/listItems"];var c=o.n(i);const p=flarum.core.compat["forum/components/Composer"];var u=o.n(p);const l=flarum.core.compat["forum/components/DiscussionComposer"];var d=o.n(l);const f=flarum.core.compat["forum/components/IndexPage"];var h=o.n(f);const v=flarum.core.compat["forum/states/ComposerState"];var g=o.n(v);function y(){return y=Object.assign?Object.assign.bind():function(o){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r])}return o},y.apply(this,arguments)}function b(o,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},b(o,t)}const w=flarum.core.compat["common/components/Page"];var C=o.n(w);const P=flarum.core.compat["common/components/LoadingIndicator"];var O=o.n(P);const N=flarum.core.compat["common/utils/extractText"];var T=o.n(N);const x=flarum.core.compat["common/utils/Stream"];var k=o.n(x),M=function(o){return n().store.all("tags").find((function(t){return 0===t.slug().localeCompare(o,void 0,{sensitivity:"base"})}))},j=function(o){var t,e;function r(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r))||this).loading=!1,t.handlers={},t}e=o,(t=r).prototype=Object.create(e.prototype),t.prototype.constructor=t,b(t,e);var s=r.prototype;return s.currentTag=function(){var o=this;return new Promise((function(t){var e=m.route.param().slug;if(!e)return t(null);var r=M(e);if(r)return t(r);o.loading=!0,n().store.find("tags",e,{include:"children,children.parent,parent,state"}).then((function(){o.loading=!1,t(M(e))}))}))},s.oninit=function(t){var e=this;o.prototype.oninit.call(this,t),n().setTitle(T()(n().translator.trans("clarkwinkelmann-composer-page.forum.page.title"))),n().setTitleCount(0),n().preloadedApiDocument();var r=n().session.user;if(!r)return this.loading=!0,void m.route.set(n().route("index"));if(!n().composer.bodyMatches(d())){n().composer.load(d(),{user:r}),n().composer.show();var s=n().composer.fields;if(s){var a=m.route.param(),i=a.title,c=a.content;i&&(s.title?s.title(i):s.title=k()(i)),c&&s.content&&s.content(c),"composeTag"===n().current.data.routeName&&this.currentTag().then((function(o){if(o){var t=o.parent();s.tags=t?[t,o]:[o]}else s.tags=[];m.redraw(),e.updateHeight()}))}}},s.view=function(){return m(".ComposerPageContainer",m(".container",m(".sideNavContainer",[m("nav.IndexPage-nav.sideNav",m("ul",c()(h().prototype.sidebarItems().toArray()))),m(".sideNavOffset",m(".ComposerPage",[m("h2.App-titleControl",n().translator.trans("clarkwinkelmann-composer-page.forum.page.heading")),this.body()]))])))},s.body=function(){var o=n().composer.body;return!o.componentClass||this.loading?O().component():o.componentClass.component(y({},o.attrs,{composer:n().composer,disabled:!1}))},s.oncreate=function(t){var e=this;o.prototype.oncreate.call(this,t),$(window).on("resize",this.handlers.onresize=this.updateHeight.bind(this)),setTimeout((function(){e.updateHeight()}),10)},s.onremove=function(t){o.prototype.onremove.call(this,t),$(window).off("resize",this.handlers.onresize),n().composer.bodyMatches(d())&&n().composer.minimize()},s.updateHeight=function(){var o=this.$(".Composer-flexible");if(o.length){var t=o.offset().top,e=parseInt(o.css("padding-bottom"),10),r=this.$(".Composer-footer").outerHeight(!0);o.height(Math.max(window.innerHeight-t-e-r,200))}},r}(C());const I=flarum.core.compat["common/components/Button"];var S=o.n(I);function H(){var o=n().current.data.routeName;return"compose"===o||"composeTag"===o}function _(o){var t=n().forum.attribute("composerPageTags");return!t||t.split(",").some((function(t){return-1!==o.indexOf(t)}))}n().initializers.add("clarkwinkelmann-composer-page",(function(){n().routes.compose={path:"/compose",component:j},n().routes.composeTag={path:"/t/:slug/compose",component:j},(0,e.override)(u().prototype,"view",(function(o){return H()?m(".Composer",[m(".Composer-handle",{oncreate:this.configHandle.bind(this)}),m("ul.Composer-controls",c()(this.controlItems().toArray())),m(".Composer-handle"),m(".Composer-content")]):o()}));var o="[]";(0,e.extend)(u().prototype,"onupdate",(function(){var t=((n().composer.fields||{}).tags||[]).map((function(o){return o.slug()})),e=JSON.stringify(t);o!==e&&(n().composer.bodyMatches(d())&&_(t)&&!H()&&n().composer.show(),o=e)})),(0,e.override)(g().prototype,"show",(function(o){var t;return this.bodyMatches(d())&&(_(((null==(t=this.fields)?void 0:t.tags)||[]).map((function(o){return o.slug()})))||H())?(this.position=g().Position.HIDDEN,void(H()||m.route.set(n().route("compose")))):o()})),(0,e.override)(g().prototype,"isVisible",(function(o){return!(!this.bodyMatches(d())||!H())||o()})),(0,e.override)(d().prototype,"oninit",(function(o,t){var e=t.attrs.composer.fields.content();o(t),this.composer.fields.content(e)})),(0,e.extend)(d().prototype,"view",(function(o){H()&&o.children.push(m(".ComposerPageMobileSubmit",S().component({icon:"fas fa-paper-plane",className:"Button Button--primary",onclick:this.onsubmit.bind(this)},this.attrs.submitLabel)))})),(0,e.extend)(h().prototype,"sidebarItems",(function(o){var t=o.get("newDiscussion");if(t&&n().session.user){if(H())return t.attrs.className=t.attrs.className.replace("Button--primary",""),t.attrs.icon="fas fa-trash",delete t.attrs.itemClassName,void(t.children=n().translator.trans("clarkwinkelmann-composer-page.forum.nav.cancel"));if(n().composer.bodyMatches(d()))return t.attrs.className=t.attrs.className.replace("Button--tagColored",""),t.attrs.className=t.attrs.className.replace("Button--primary",""),t.attrs.style&&delete t.attrs.style["--color"],void(t.children=n().translator.trans("clarkwinkelmann-composer-page.forum.nav.continue"));var e=this.currentTag&&this.currentTag(),r=[];if(e){r.push(e.slug());var s=e.parent();s&&r.push(s.slug())}_(r)&&(t.tag=a(),t.attrs.href=e?n().route("composeTag",{slug:e.slug()}):n().route("compose"),delete t.attrs.onclick)}})),(0,e.override)(h().prototype,"newDiscussionAction",(function(o){return H()?(n().composer.close(),n().composer.body.componentClass||m.route.set(n().route("index")),Promise.resolve()):n().composer.bodyMatches(d())?(n().composer.show(),Promise.resolve()):o()}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map